# 23장 디버깅


### 디버깅 성과의 차이
| | 가장 빠른 세 명의 개발자 | 가장 느린 세 명의 개발자
|----|----|----|
|평균 디버깅 시간| 5.0 | 14.1 |
|미발견된 평균 결함 수| 0.7 | 1.7 |
|평균 디버깅 시간| 3.0 | 7.7 |

### 기회로써의 결함
- 개발 중인 프로그램에 관해 배울 수 있다.
- 자신이 저지른 실수에 관해 배울 수 있다.
- 자신의 코드를 읽어야하는 사람의 관점으로부터 코드의 품질에 관해 배울 수 있다. 자신이 작성한 코드를 읽기 쉬운지 경험하고 비판적으로 볼 수 있는 기회이다.
- 문제를 해결하는 방법을 배울 수 있다.
- 결함을 수정하는 방법을 배울 수 있다.

### 비효과적인 접근방법
- 추측으로 결함을 찾아라. 마구잡이로 출력문 찍어보기
- 문제를 이해하는데 시간을 쓰지 않기
- 가장 명백한 수정으로 오류를 수정해라.
```typescript
var x = compute(y);

if (y === 17) {
  x = 25.15 // y가 17일때만 동작하지 않으니 이것을 고친다.
}
```

## 결함 발견
### 과학적 디버깅방법
1. 오류를 재현한다.
2. 오류("결점")의 원인을 찾아낸다.
  a. 결함을 만들어내는 데이터를 수집한다.
  b. 수집된 데이터를분석하고 결함에 대한 가설을 세운다.
  c. 프로그래믕ㄹ 테스트하거나 코드를 살펴봄으로써 가설을 증명하거나 반증할 방법을 결정한다.
  d. 2(c) 에서 규명한 절차를 사용하여 가설을 증명하거나 반증한다.
3. 결함을 수정한다.
4. 수정 내용을 테스트한다.
5. 유사한 오류를 찾는다.

### 오류를 재현하라
- 예측 불가능한 오류는 보통 초기화오류, 시간문제, 허상포인터 문제다.
- 초기화 오류: 간헐적으로 오류가 난다면 변수가 적절히 초기화되지 않을 때
- 허상포인터: 문제가 낯설고 예측할 수 없는 현상이고 포인터를 사용할 때
- 오류를 만들어내는 가장 단순한 테스트 케이스로 범위를 좁혀가야한다.
- 오류가 10개의 요소를 조합하는 상황에서 발생한다면, 하나씩 제거해가면서 관련없는 요소들을 제외시킨다.

### 오류의 원인을 찾아라
- 의심이 드는 매개변수를 경계의 아래, 경계 내, 경계 위쪽으로 변경하면서 테스트

### 결함을 찾는 데 도움이 되는 팁
- 가설을 세우기 위해서 사용할 수 있는 모든 데이터를 사용하라.
다양한 데이터 유형으로 테스트
- 오류를 만드는 테스트 케이스 개선
기존의 테스트 케이스를 개선해보기
- 단위 테스트에서 코드를 다루기
고립된 환경에서 테스트
- 도구를 사용
- 여러가지 방법으로 오류를 발생시켜라
정확히 재현이 되지 않을 때 여러방법으로 오류를 발생시키면서 삼각측량해 나간다.
- 더 많은 가설을 세우기 위해서 더 많은 데이터를 만들어라.
- 부정적 테스트의 결과를 사용하라.
기존의 가설을 부정하는 테스트 케이스를 통해서 가능한 가설의 폭을 좁힌다.
- 가능한 가설에 대해서 브레인스토밍
- 연습장을 준비해서 시도해 볼 목록을 만들어라
- 의심스러운 코드영역을 좁혀라
- 이전에 결함이 있었던 클래스와 루틴을 의심하라.
과거에 문제가 있었던 부분은 또 문제를 발생시킬 확률 이 높다.
- 최근에 변경한 코드를 검사하라.
- 의심스러운 코드 영역을 확장하라.
- 점진적으로 통합하라.
- 일반적인 결함을 검사한다.
- 프로그램에 대해 다른 사람과 이야기를 나누어라.
문제에 대해 설명하다보면 스스로 답을 찾을 수도 있다.
- 문제로부터 떨어져 휴식을 취하라.

## 결함수정
- 수정하기 전에 문제를 이해하라.
- 문제만 이해 하지말고 프로그램을 이해하라.
- 결함 분석을 확인하라.
여러 케이스 중 한가지만 해결한 상황이라면, 수정하기에 충분한 상태가 아닐 수 있다.
- 긴장을 풀어라.
휴가직전에 수정하게되면 충분한 테스트를 거치지 않고 배포하게 될 수 있음. 차라리 충분한 여유를 갖고 수정&배포
- 증상이 아니라 문제를 해결하라.
```typescript
for (let i = 0; i < client.length; i++) {
  sum = sum + client[i].amount;
}

if (client === 45) {
  sum = sum + 3.45 // 45일 때 3.45가 부족한 문제를 "해결"하고 있다.
}
```
- 타당한 이유가 있을 때만 코드를 변경하라.
- 한 번에 한 가지만 변경하라.
- 수정한 내용을 검사하라.
- 결함을 노출하는 단위테스틑 추가하라.
- 유사한 결함을 찾아라.ㅈ


